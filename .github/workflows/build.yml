name: Build and Test

on:
  push:
    branches:
    - '**'
  pull_request:
    branches:
    - '**'

jobs:
  build-linux-run-tests:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v6
    - name: show Ubuntu version
      run: cat /etc/os-release | grep PRETTY_NAME | awk -F '=' '{print $2}'
    - name: update build environment
      run: sudo apt-get update --fix-missing -y
    - name: install prerequisites
      run: |
       sudo apt-get install -y
            libcups2-dev \
            libcupsfilters-dev \
            libppd-dev \
            ghostscript \
            liblcms2-dev \
            libpoppler-cpp-dev \
            libpng-dev \
            libjpeg-dev \
            libtiff5-dev \
            zlib1g-dev \
            libfontconfig1-dev \
            libdbus-1-dev \
            libexif-dev \
            libavahi-common-dev \
            libavahi-client-dev \
            libtool \
            gettext \
            autopoint \
            mupdf-tools

    - name: configure 
      env:
        CC: /usr/bin/gcc
      run: ./autogen.sh && ./configure
    - name: make
      run: make
    - name: Run Tests
      run: make check || cat test/error_log*
